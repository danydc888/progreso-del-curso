<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Profile Display</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .header { background: #3b82f6; color: white; padding: 20px; margin-bottom: 20px; }
        .header-content { display: flex; align-items: center; gap: 1rem; }
        .profile-info { display: flex; align-items: center; gap: 10px; }
        .profile-avatar-small { 
            width: 40px; height: 40px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-weight: bold;
            background-color: #10b981;
        }
        .profile-name { font-size: 16px; font-weight: 500; }
        button { padding: 10px 20px; margin: 10px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <button class="btn btn-back">Cambiar Perfil</button>
        </div>
        <h1 style="text-align: center; margin: 0;">Progreso del Curso</h1>
        <div class="profile-info">
            <div class="current-profile" id="current-profile-info">
                <div class="profile-avatar-small" id="profile-avatar">
                    <!-- Avatar will be populated by JavaScript -->
                </div>
                <div class="profile-name" id="profile-name">
                    <!-- Name will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="debug">
        <h3>Debug Info:</h3>
        <div id="debug-output"></div>
    </div>
    
    <button onclick="testProfile()">Probar Perfil</button>
    <button onclick="setTestProfile()">Establecer Perfil de Prueba</button>
    <button onclick="clearProfile()">Limpiar Perfil</button>

    <script>
        function displayCurrentProfile() {
            console.log('=== displayCurrentProfile START ===');
            const profileAvatar = document.getElementById('profile-avatar');
            const profileName = document.getElementById('profile-name');
            
            console.log('Elements found:', { 
                profileAvatar: !!profileAvatar, 
                profileName: !!profileName,
                profileAvatarElement: profileAvatar,
                profileNameElement: profileName
            });
            
            if (!profileAvatar || !profileName) {
                console.log('Profile elements not found');
                updateDebugOutput('ERROR: Elementos no encontrados');
                return;
            }
            
            const currentProfile = JSON.parse(sessionStorage.getItem('currentProfile') || 'null');
            console.log('Current profile from sessionStorage:', currentProfile);
            
            if (!currentProfile) {
                console.log('No current profile');
                profileAvatar.textContent = '?';
                profileName.textContent = 'Sin perfil';
                profileAvatar.style.backgroundColor = '#ccc';
                updateDebugOutput('No hay perfil seleccionado');
                return;
            }
            
            // Generar iniciales del nombre
            const initials = currentProfile.name
                .split(' ')
                .map(word => word.charAt(0).toUpperCase())
                .join('')
                .substring(0, 2);
            
            console.log('Setting profile info:', { initials, name: currentProfile.name });
            
            // Actualizar avatar con iniciales
            profileAvatar.textContent = initials;
            
            // Actualizar nombre del perfil
            profileName.textContent = currentProfile.name;
            
            // Aplicar color del perfil al avatar si existe
            if (currentProfile.color) {
                const colorMap = {
                    'blue': '#3b82f6',
                    'purple': '#8b5cf6', 
                    'red': '#ef4444',
                    'green': '#10b981',
                    'orange': '#f59e0b',
                    'pink': '#ec4899',
                    'teal': '#14b8a6',
                    'indigo': '#6366f1',
                    'yellow': '#eab308',
                    'emerald': '#059669',
                    'rose': '#f43f5e',
                    'slate': '#64748b'
                };
                const color = colorMap[currentProfile.color] || '#3b82f6';
                profileAvatar.style.backgroundColor = color;
                console.log('Applied color:', color);
            } else {
                // Color por defecto si no hay color específico
                profileAvatar.style.backgroundColor = '#3b82f6';
            }
            
            updateDebugOutput(`Perfil cargado: ${currentProfile.name} (${initials})`);
            console.log('=== displayCurrentProfile END ===');
        }
        
        function testProfile() {
            console.log('Testing profile display...');
            displayCurrentProfile();
        }
        
        function setTestProfile() {
            const testProfile = {
                id: 'test123',
                name: 'Juan Pérez',
                avatar: 'boy1',
                grade: '3er Grado',
                cycle: '2024-2025',
                color: 'blue'
            };
            sessionStorage.setItem('currentProfile', JSON.stringify(testProfile));
            console.log('Test profile set:', testProfile);
            displayCurrentProfile();
        }
        
        function clearProfile() {
            sessionStorage.removeItem('currentProfile');
            console.log('Profile cleared');
            displayCurrentProfile();
        }
        
        function updateDebugOutput(message) {
            const debugDiv = document.getElementById('debug-output');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        }
        
        // Cargar perfil al iniciar
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, calling displayCurrentProfile...');
            displayCurrentProfile();
        });
    </script>
</body>
</html>
